#!/bin/sh -e
export localstatedir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/var"

export prefix="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr"

export CPP="gcc -E"

export mandir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/man"

export STRIP="strip"

export STAGING_SIPDIR="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/sip"

export BUILD_CXXFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include -Os -fpermissive"

export OBJCOPY="objcopy"

export AR="ar"

export SDK_CPPFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-mingw32/usr/include -isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include"

export AS="as"

export PSTAGING_ACTIVE="1"

export libexecdir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/libexec"

export RANLIB="ranlib"

export QTDIR="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/qt2"

export BUILD_CXX="ccache g++"

export datadir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share"

export SDK_LDFLAGS="-L/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-mingw32/usr/lib -Wl,-rpath-link,/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-mingw32/usr/lib -Wl,-O1"

export LD="ld"

export EXTRA_OEMAKE="-e MAKEFLAGS="

export LDFLAGS="-L/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib -Wl,-rpath-link,/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib -Wl,-rpath,/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib -Wl,-O1"

export TARGET_CXXFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include -fexpensive-optimizations -fomit-frame-pointer -frename-registers -Os -fpermissive"

export MAKE="make"

export includedir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include"

export TARGET_CPPFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include"

export OPIEDIR="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux"

export BUILD_CC="ccache gcc"

export BUILD_LDFLAGS="-L/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib -Wl,-rpath-link,/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib -Wl,-rpath,/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib -Wl,-O1"

unset TARGET_ARCH

export bindir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/bin"

export OBJDUMP="objdump"

export BUILD_LD="ld"

export exec_prefix="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr"

export oldincludedir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include"

export CCLD="ccache gcc"

export SHELLCMDS="bash --rcfile $TERMRCFILE"

export QPEDIR="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux"

export BUILD_CCLD="gcc"

export base_libdir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/lib"

export PATH="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/bin:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/bin/i686-linux:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/sbin:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/bin:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/cross/i686/bin:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/sbin:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/bin:/home/dhuggins/Projects/TeRK/terkos/oe/openembedded/bitbake/bin:/usr/local/bin:/usr/bin:/bin:/usr/bin/X11:/usr/games"

export TARGET_CFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include -fexpensive-optimizations -fomit-frame-pointer -frename-registers -Os"

export base_bindir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/bin"

export servicedir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/srv"

export BUILD_CPP="cpp"

export SDK_CXXFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-mingw32/usr/include -isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include -fexpensive-optimizations -fomit-frame-pointer -frename-registers -Os -fpermissive"

export sbindir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/sbin"

export SDK_CFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-mingw32/usr/include -isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include -fexpensive-optimizations -fomit-frame-pointer -frename-registers -Os"

export BUILD_AR="ar"

export sharedstatedir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/com"

export F77="ccache g77"

export XDG_DATA_DIRS="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share"

export BUILD_CFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include -Os"

unset DISTRO

export STAGING_IDLDIR="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/idl"

export QMAKE_MKSPEC_PATH="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/qmake"

export PKG_CONFIG_DIR="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib/pkgconfig"

export PKG_CONFIG_DISABLE_UNINSTALLED="yes"

export infodir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/info"

export libdir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib"

export base_prefix="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux"

export CC="ccache gcc"

export TARGET_LDFLAGS="-L/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib -Wl,-rpath-link,/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib -Wl,-O1 -Wl,--hash-style=gnu"

export BUILD_F77="ccache g77"

export CPPFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include"

export docdir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/doc"

export palmqtdir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib/opie"

export base_sbindir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/sbin"

export CXX="ccache g++"

export palmtopdir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib/opie"

export PKG_CONFIG_PATH="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib/pkgconfig:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/pkgconfig${EXTRA_NATIVE_PKGCONFIG_PATH}"

unset MACHINE

export PATCH_GET="0"

export CXXFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include -Os"

export MANIFEST="/home/dhuggins/Projects/TeRK/terkos/oe/openembedded/recipes/gnu-config/gnu-config/manifest"

export BUILD_STRIP="strip"

export CFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include -Os"

export BUILD_RANLIB="ranlib"

export sysconfdir="/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc"

export BUILD_CPPFLAGS="-isystem/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/include"

do_devshell() {
	devshell_do_devshell

}

base_do_checkuriall() {
	:

}

populate_staging_preamble() {
	if [ "$PSTAGING_ACTIVE" = "1" ]; then
		stage-manager -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging -c /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/stamp-cache-staging -u || true
		stage-manager -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/cross/i686 -c /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/stamp-cache-cross -u || true
	fi

}

die() {
	oefatal "$*"

}

base_do_install() {
	:

}

do_fetchall() {
	base_do_fetchall

}

do_stage() {
	install -d /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/gnu-config/
	install -d /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/bin/
	cat /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/gnu-configize.in | \
		sed -e 's,@gnu-configdir@,/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/gnu-config,' \
		    -e 's,@autom4te_perllibdir@,/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/autoconf,' > /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/bin/gnu-configize
	chmod 755 /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/bin/gnu-configize
	install -m 0644 config.guess config.sub /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/share/gnu-config/

}

do_package_stage_all() {
	:

}

base_do_compile() {
	if [ -e Makefile -o -e makefile ]; then
		oe_runmake || die "make failed"
	else
		oenote "nothing to compile"
	fi

}

base_do_fetchall() {
	:

}

base_do_package() {
	:

}

oewarn() {
	echo "WARNING:" "$*"

}

oe_machinstall() {
	# Purpose: Install machine dependent files, if available
	#          If not available, check if there is a default
	#          If no default, just touch the destination
	# Example:
	#                $1  $2   $3         $4
	# oe_machinstall -m 0644 fstab /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/image/etc/fstab
	#
	# TODO: Check argument number?
	#
	filename=`basename $3`
	dirname=`dirname $3`

	for o in `echo task-setscene:local:qwerk:terkos:linux:i686:build-linux:fail-fast:pn-gnu-config-native:thumb-interwork:armv4t | tr ':' ' '`; do
		if [ -e $dirname/$o/$filename ]; then
			oenote $dirname/$o/$filename present, installing to $4
			install $1 $2 $dirname/$o/$filename $4
			return
		fi
	done
#	oenote overrides specific file NOT present, trying default=$3...
	if [ -e $3 ]; then
		oenote $3 present, installing to $4
		install $1 $2 $3 $4
	else
		oenote $3 NOT present, touching empty $4
		touch $4
	fi

}

package_stagefile_shell() {
	if [ "$PSTAGING_ACTIVE" = "1" ]; then
		srcfile=$1
		destfile=`echo $srcfile | sed s#/home/dhuggins/Projects/TeRK/terkos/oe/tmp#/home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg#`
		destdir=`dirname $destfile`
		mkdir -p $destdir
		cp -dp $srcfile $destfile
	fi

}

base_do_buildall() {
	:

}

do_configure() {
	base_do_configure

}

do_compile() {
	:

}

staging_packager() {

	mkdir -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL
	mkdir -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/terkosuclibc-home-dhuggins-Projects-TeRK-terkos-oe-tmp

	echo "Package: staging-gnu-config-native-i686-linux"         >  /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL/control
	echo "Version: 0.1+cvs20050701-r5"    >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL/control
	echo "Description: gnu-configize"      >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL/control
	echo "Section: base"              >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL/control
	echo "Priority: Optional"               >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL/control
	echo "Maintainer: OpenEmbedded Team <openembedded-devel@lists.openembedded.org>"        >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL/control
	echo "Architecture: i686-linux"  >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL/control

	# Protect against empty SRC_URI
	if [ "cvs://anonymous@cvs.sv.gnu.org/cvsroot/config;module=config;method=pserver;date=20050701 	   file://config-guess-uclibc.patch;patch=1            file://avr32.patch;patch=1            file://gnu-configize.in" != "" ] ; then
		echo "Source: cvs://anonymous@cvs.sv.gnu.org/cvsroot/config;module=config;method=pserver;date=20050701 	   file://config-guess-uclibc.patch;patch=1            file://avr32.patch;patch=1            file://gnu-configize.in"               >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL/control
	else
		echo "Source: OpenEmbedded"               >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/CONTROL/control
	fi

	stage-manager-ipkg-build -o 0 -g 0 /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/terkosuclibc-home-dhuggins-Projects-TeRK-terkos-oe-tmp

}

SRC_DISTRIBUTECOMMAND() {
	s="${SRC}"
	if [ ! -L "$s" ] && (echo "$s"|grep "^${OEROOT}/sources"); then
		:
	else
		exit 0;
	fi
	mkdir -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/sources
	case "symlink" in
		copy)
			test -e $s.md5 && cp -f $s.md5 /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/sources/
			cp -f $s /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/sources/
			;;
		symlink)
			test -e $s.md5 && ln -sf $s.md5 /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/sources/
			ln -sf $s /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/sources/
			;;
		move+symlink)
			mv $s /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/sources/
			ln -sf /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/sources/`basename $s` $s
			;;
	esac

}

devshell_do_devshell() {
	export TERMWINDOWTITLE="Bitbake Developer Shell"
	gnome-terminal --disable-factory -t "$TERMWINDOWTITLE"
	if [ $? -ne 0 ]; then
	    echo "Fatal: 'gnome-terminal --disable-factory -t "$TERMWINDOWTITLE"' not found. Check TERMCMD variable."
	    exit 1
	fi

}

oe_soinstall() {
	# Purpose: Install shared library file and
	#          create the necessary links
	# Example:
	#
	# oe_
	#
	#oenote installing shared library $1 to $2
	#
	libname=`basename $1`
	install -m 755 $1 $2/$libname
	sonamelink=`readelf -d $1 |grep 'Library soname:' |sed -e 's/.*\[\(.*\)\].*/\1/'`
	solink=`echo $libname | sed -e 's/\.so\..*/.so/'`
	ln -sf $libname $2/$sonamelink
	ln -sf $libname $2/$solink

}

oe_libinstall() {
	# Purpose: Install a library, in all its forms
	# Example
	#
	# oe_libinstall libltdl /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib/
	# oe_libinstall -C src/libblah libblah /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/image//home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib/
	dir=""
	libtool=""
	silent=""
	require_static=""
	require_shared=""
	staging_install=""
	while [ "$#" -gt 0 ]; do
		case "$1" in
		-C)
			shift
			dir="$1"
			;;
		-s)
			silent=1
			;;
		-a)
			require_static=1
			;;
		-so)
			require_shared=1
			;;
		-*)
			oefatal "oe_libinstall: unknown option: $1"
			;;
		*)
			break;
			;;
		esac
		shift
	done

	libname="$1"
	shift
	destpath="$1"
	if [ -z "$destpath" ]; then
		oefatal "oe_libinstall: no destination path specified"
	fi
	if echo "$destpath/" | egrep '^/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib/' >/dev/null
	then
		staging_install=1
	fi

	__runcmd () {
		if [ -z "$silent" ]; then
			echo >&2 "oe_libinstall: $*"
		fi
		$*
	}

	if [ -z "$dir" ]; then
		dir=`pwd`
	fi

	dotlai=$libname.lai

	# Sanity check that the libname.lai is unique
	number_of_files=`(cd $dir; find . -name "$dotlai") | wc -l`
	if [ $number_of_files -gt 1 ]; then
		oefatal "oe_libinstall: $dotlai is not unique in $dir"
	fi


	dir=$dir`(cd $dir;find . -name "$dotlai") | sed "s/^\.//;s/\/$dotlai\$//;q"`
	olddir=`pwd`
	__runcmd cd $dir

	lafile=$libname.la

	# If such file doesn't exist, try to cut version suffix
	if [ ! -f "$lafile" ]; then
		libname1=`echo "$libname" | sed 's/-[0-9.]*$//'`
		lafile1=$libname.la
		if [ -f "$lafile1" ]; then
			libname=$libname1
			lafile=$lafile1
		fi
	fi

	if [ -f "$lafile" ]; then
		# libtool archive
		eval `cat $lafile|grep "^library_names="`
		libtool=1
	else
		library_names="$libname.so* $libname.dll.a"
	fi

	__runcmd install -d $destpath/
	dota=$libname.a
	if [ -f "$dota" -o -n "$require_static" ]; then
		__runcmd install -m 0644 $dota $destpath/
	fi
	if [ -f "$dotlai" -a -n "$libtool" ]; then
		if test -n "$staging_install"
		then
			# stop libtool using the final directory name for libraries
			# in staging:
			__runcmd rm -f $destpath/$libname.la
			__runcmd sed -e 's/^installed=yes$/installed=no/' \
				     -e '/^dependency_libs=/s,/home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5[[:alnum:]/\._+-]*/\([[:alnum:]\._+-]*\),/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib/\1,g' \
				     -e "/^dependency_libs=/s,\([[:space:]']\)/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib,\1/home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/usr/lib,g" \
				     $dotlai >$destpath/$libname.la
		else
			__runcmd install -m 0644 $dotlai $destpath/$libname.la
		fi
	fi

	for name in $library_names; do
		files=`eval echo $name`
		for f in $files; do
			if [ ! -e "$f" ]; then
				if [ -n "$libtool" ]; then
					oefatal "oe_libinstall: $dir/$f not found."
				fi
			elif [ -L "$f" ]; then
				__runcmd cp -P "$f" $destpath/
			elif [ ! -L "$f" ]; then
				libfile="$f"
				__runcmd install -m 0755 $libfile $destpath/
			fi
		done
	done

	if [ -z "$libfile" ]; then
		if  [ -n "$require_shared" ]; then
			oefatal "oe_libinstall: unable to locate shared library"
		fi
	elif [ -z "$libtool" ]; then
		# special case hack for non-libtool .so.#.#.# links
		baselibfile=`basename "$libfile"`
		if (echo $baselibfile | grep -qE '^lib.*\.so\.[0-9.]*$'); then
			sonamelink=`readelf -d $libfile |grep 'Library soname:' |sed -e 's/.*\[\(.*\)\].*/\1/'`
			solink=`echo $baselibfile | sed -e 's/\.so\..*/.so/'`
			if [ -n "$sonamelink" -a x"$baselibfile" != x"$sonamelink" ]; then
				__runcmd ln -sf $baselibfile $destpath/$sonamelink
			fi
			__runcmd ln -sf $baselibfile $destpath/$solink
		fi
	fi

	__runcmd cd "$olddir"

}

base_do_configure() {
	:

}

base_do_distsrcall() {
	:

}

oenote() {
	echo "NOTE:" "$*"

}

package_update_index_ipk() {
	set -x

	ipkgarchs="all any noarch i686  armv4 armv4t qwerk"

	if [ ! -z "${DEPLOY_KEEP_PACKAGES}" ]; then
		return
	fi

	touch /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/Packages
	ipkg-make-index -r /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/Packages -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/Packages -l /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/Packages.filelist -m /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk

	for arch in $ipkgarchs; do
		if [ -e /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/$arch/ ] ; then
			touch /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/$arch/Packages
			ipkg-make-index -r /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/$arch/Packages -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/$arch/Packages -l /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/$arch/Packages.filelist -m /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/$arch/
		fi
		if [ -e /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-$arch-sdk/ ] ; then
			touch /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-$arch-sdk/Packages
			ipkg-make-index -r /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-$arch-sdk/Packages -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-$arch-sdk/Packages -l /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-$arch-sdk/Packages.filelist -m /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-$arch-sdk/
		fi
		if [ -e /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-mingw32-sdk-$arch/ ] ; then
			touch /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-mingw32-sdk-$arch/Packages
			ipkg-make-index -r /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-mingw32-sdk-$arch/Packages -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-mingw32-sdk-$arch/Packages -l /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-mingw32-sdk-$arch/Packages.filelist -m /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-mingw32-sdk-$arch/
		fi
	done

}

do_package_write() {
	:

}

package_generate_ipkg_conf() {
	mkdir -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/
	echo "src oe file:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk" > /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/opkg.conf
	echo "src oe file:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk" > /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/opkg-sdk.conf
	echo "src oe file:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk" > /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/opkg-canadian-sdk.conf
	ipkgarchs="all any noarch i686  armv4 armv4t qwerk"
	priority=1
	for arch in $ipkgarchs; do
		echo "arch $arch $priority" >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/opkg.conf
		echo "arch i686-$arch-sdk $priority" >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/opkg-sdk.conf
		echo "arch i686-mingw32-sdk-$arch $priority" >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/opkg-canadian-sdk.conf
		priority=$(expr $priority + 5)
		if [ -e /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/$arch/Packages ] ; then
		        echo "src oe-$arch file:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/$arch" >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/opkg.conf
		fi
		if [ -e /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-$arch-sdk/Packages ] ; then
		        echo "src oe-i686-$arch-sdk file:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-$arch-sdk" >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/opkg-sdk.conf
		fi
		if [ -e /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-mingw32-sdk-$arch/Packages ] ; then
		        echo "src oe-i686-mingw32-sdk-$arch file:/home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/ipk/i686-mingw32-sdk-$arch" >> /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging/i686-linux/etc/opkg-canadian-sdk.conf
		fi
	done

}

do_install() {
	true

}

base_do_stage() {
	:

}

MIRRORS() {
ftp://ftp.debian.org/debian/pool/main	http://snapshot.debian.net/archive/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.de.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.au.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.cl.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.hr.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.fi.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.hk.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.hu.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.ie.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.it.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.jp.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.no.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.pl.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.ro.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.si.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.es.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.se.debian.org/debian/pool
ftp://ftp.debian.org/debian/pool	ftp://ftp.tr.debian.org/debian/pool
ftp://ftp.gnu.org/gnu	ftp://mirrors.kernel.org/gnu
ftp://ftp.gnu.org/gnu	ftp://ftp.matrix.com.br/pub/gnu
ftp://ftp.gnu.org/gnu	ftp://ftp.cs.ubc.ca/mirror2/gnu
ftp://ftp.gnu.org/gnu	ftp://sunsite.ust.hk/pub/gnu
ftp://ftp.gnu.org/gnu	ftp://ftp.ayamura.org/pub/gnu
http://kernel.org	http://www.kernel.org/pub
http://kernel.org	ftp://ftp.us.kernel.org/pub
http://kernel.org	ftp://ftp.uk.kernel.org/pub
http://kernel.org	ftp://ftp.hk.kernel.org/pub
http://kernel.org	ftp://ftp.au.kernel.org/pub
http://kernel.org	ftp://ftp.jp.kernel.org/pub
ftp://ftp.gnupg.org/gcrypt/     ftp://ftp.franken.de/pub/crypt/mirror/ftp.gnupg.org/gcrypt/
ftp://ftp.gnupg.org/gcrypt/     ftp://ftp.surfnet.nl/pub/security/gnupg/
ftp://ftp.gnupg.org/gcrypt/     http://gulus.USherbrooke.ca/pub/appl/GnuPG/
ftp://dante.ctan.org/tex-archive ftp://ftp.fu-berlin.de/tex/CTAN
ftp://dante.ctan.org/tex-archive http://sunsite.sut.ac.jp/pub/archives/ctan/
ftp://dante.ctan.org/tex-archive http://ctan.unsw.edu.au/
ftp://ftp.gnutls.org/pub/gnutls ftp://ftp.gnutls.org/pub/gnutls/
ftp://ftp.gnutls.org/pub/gnutls ftp://ftp.gnupg.org/gcrypt/gnutls/
ftp://ftp.gnutls.org/pub/gnutls http://www.mirrors.wiretapped.net/security/network-security/gnutls/
ftp://ftp.gnutls.org/pub/gnutls ftp://ftp.mirrors.wiretapped.net/pub/security/network-security/gnutls/
ftp://ftp.gnutls.org/pub/gnutls http://josefsson.org/gnutls/releases/
http://ftp.info-zip.org/pub/infozip/src/ http://mirror.switch.ch/ftp/mirror/infozip/src/
http://ftp.info-zip.org/pub/infozip/src/ ftp://sunsite.icm.edu.pl/pub/unix/archiving/info-zip/src/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://ftp.cerias.purdue.edu/pub/tools/unix/sysutils/lsof/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://ftp.tau.ac.il/pub/unix/admin/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://ftp.cert.dfn.de/pub/tools/admin/lsof/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://ftp.fu-berlin.de/pub/unix/tools/lsof/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://ftp.kaizo.org/pub/lsof/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://ftp.tu-darmstadt.de/pub/sysadmin/lsof/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://ftp.tux.org/pub/sites/vic.cc.purdue.edu/tools/unix/lsof/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://gd.tuwien.ac.at/utils/admin-tools/lsof/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://sunsite.ualberta.ca/pub/Mirror/lsof/
ftp://lsof.itap.purdue.edu/pub/tools/unix/lsof/  ftp://the.wiretapped.net/pub/security/host-security/lsof/
http://www.apache.org/dist  http://archive.apache.org/dist


}

staging_package_installer() {
	#stage-manager-ipkg -f /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/opkg.conf -force-depends -o /home/dhuggins/Projects/TeRK/terkos/oe/tmp install /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/terkosuclibc-home-dhuggins-Projects-TeRK-terkos-oe-tmp/staging-gnu-config-native-i686-linux_0.1+cvs20050701-r5_i686-linux.ipk

	STATUSFILE=/home/dhuggins/Projects/TeRK/terkos/oe/tmp/usr/lib/opkg/status
	echo "Package: staging-gnu-config-native-i686-linux"        >> $STATUSFILE
	echo "Version: 0.1+cvs20050701-r5"   >> $STATUSFILE
	echo "Status: install user installed"  >> $STATUSFILE
	echo "Architecture: i686-linux" >> $STATUSFILE
	echo "" >> $STATUSFILE

	CTRLFILE=/home/dhuggins/Projects/TeRK/terkos/oe/tmp/usr/lib/opkg/info/staging-gnu-config-native-i686-linux.control
	echo "Package: staging-gnu-config-native-i686-linux"        > $CTRLFILE
	echo "Version: 0.1+cvs20050701-r5"   >> $CTRLFILE
	echo "Architecture: i686-linux" >> $CTRLFILE

	cd /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg
	find -type f | grep -v ./CONTROL | sed -e 's/^\.//' > /home/dhuggins/Projects/TeRK/terkos/oe/tmp/usr/lib/opkg/info/staging-gnu-config-native-i686-linux.list

}

ldconfig_postinst_fragment() {
if [ x"$D" = "x" ]; then
	if [ -e /etc/ld.so.conf ] ; then
		[ -x /sbin/ldconfig ] && /sbin/ldconfig
	fi
fi

}

populate_staging_postamble() {
	if [ "$PSTAGING_ACTIVE" = "1" ]; then
		# list the packages currently installed in staging
		# stage-manager-ipkg -f /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/opkg.conf -o /home/dhuggins/Projects/TeRK/terkos/oe/tmp list_installed | awk '{print $1}' > /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/installed-list

		# exitcode == 5 is ok, it means the files change
		set +e
		stage-manager -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging -c /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/stamp-cache-staging -u -d /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/staging
		exitcode=$?
		if [ "$exitcode" != "5" -a "$exitcode" != "0" ]; then
			exit $exitcode
		fi
		stage-manager -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/cross/i686 -c /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/stamp-cache-cross -u -d /home/dhuggins/Projects/TeRK/terkos/oe/tmp/work/i686-linux/gnu-config-native-0.1+cvs20050701-r5/staging-pkg/cross
		if [ "$exitcode" != "5" -a "$exitcode" != "0" ]; then
			exit $exitcode
		fi
		set -e
	fi

}

oedebug() {
	test $# -ge 2 || {
		echo "Usage: oedebug level \"message\""
		exit 1
	}

	test ${OEDEBUG:-0} -ge $1 && {
		shift
		echo "DEBUG:" $*
	}

}

oe_runmake() {
	if [ x"$MAKE" = x ]; then MAKE=make; fi
	oenote make -e MAKEFLAGS= "$@"
	make -e MAKEFLAGS= "$@" || die "oe_runmake failed"

}

staging_helper() {
	# Assemble appropriate opkg.conf
	conffile=/home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/opkg.conf
	mkdir -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/deploy/pstage/pstaging_lists
	if [ ! -e $conffile ]; then
		ipkgarchs="i686-linux"
		priority=1
		for arch in $ipkgarchs; do
			echo "arch $arch $priority" >> $conffile
			priority=$(expr $priority + 5)
		done
		echo "dest root /" >> $conffile
	fi
	if [ ! -e /home/dhuggins/Projects/TeRK/terkos/oe/tmp/usr/lib/opkg/info/ ]; then
		mkdir -p /home/dhuggins/Projects/TeRK/terkos/oe/tmp/usr/lib/opkg/info/
	fi
 	if [ ! -e /home/dhuggins/Projects/TeRK/terkos/oe/tmp/usr/lib/ipkg/ ]; then
		cd /home/dhuggins/Projects/TeRK/terkos/oe/tmp/usr/lib/
		ln -sf opkg/ ipkg
	fi

}

oefatal() {
	echo "FATAL:" "$*"
	exit 1

}

cd /home/dhuggins/Projects/TeRK/terkos/oe/tmp/staging
staging_helper
